# Millida-Rating-Plugin

Плагин для выдачи наград проголосовавшим на мониторинге <b>Millida Rating</b>.

## Поддерживаемые версии:
* `Bukkit/Spigot/Paper 1.8 — 1.21`

## Фичи:
* Выдача наград
* Накопительная система наград, как в батл-пасах
* Поддержка MySQL и SQLite СУБД
* Интеграция с DecentHolograms
* Интеграция с PlaceholderAPI

# Установка

После перекидывания плагина в папку `plugins`, нужно включить и выключить сервер, т.к. плагин не работает без
предварительной настройки в целях безопасности. Для первоначального запуска хватит лишь настроить `server_id`.

**[!!!]** Если вы не хотите выдавать награды за голоса, сделанные до установки плагина, то перед первым запуском
плагина поставьте `rewards.enabled: false` и просто выполните команду `/rating admin clearrewards` после старта
сервера.

Для удобной настройки во время работы сервера есть команда `/rating admin reload`, однако крайне рекомендуется
использовать её исключительно во время тестирования, но никак не во время уже работающего сервера с игроками.
К этой команде можно добавить только `holograms` и `gui`, чтобы перезагрузить только модуль с голограммами.

Также для тестирования настроек плагина есть команды `/rating admin clear <ник>` и `/rating admin 
vote <ник>`, которые очищают прогресс игрока и выдают ему один ненастоящий голос соответственно.

**[!!!]** Если что-то идёт не так, плагин сразу же выключается в целях безопасности, чтобы игроки не теряли свои награды
и не получали их незаслуженно много.

# Права

* `millida.rating.command` — доступ к команде `/rating` как таковой. По умолчанию выдана всем игрокам.
* `millida.rating.command.rewards` — доступ к команде `/rewards` и `/rating rewards`. По умолчанию выдана всем игрокам.
Саму, команду, кстати можно поменять, изменив `config.yml` и `plugin.yml`
* `millida.rating.command.admin` — доступ к команде `/rating admin`. По умолчанию выдана всем операторам
# Интеграции

## DecentHolograms

Если на сервере установлен плагин `DecentHolograms`, то в папке сервера появляется ещё один конфиг: `holograms.yml`.
По дефолту, голограммы выключены, однако их можно включить и настроить через этот конфиг.

## PlaceholderAPI

Если на сервере установлен плагин `PlaceholderAPI`, то автоматически регистрируются следующие плейсхолдеры:

* `millidarating_top_<day/week/month<_<1-10>`

  Пример использования:
  * `millidarating_top_day_1` — топ-1 за день *(максимум 10)*
  * `millidarating_top_week_2` — топ-2 за неделю *(максимум 10)*
  * `millidarating_top_month_3` — топ-3 за месяц *(максимум 10)*

* `millidarating_top_<day/week/month<_<1-10>_votes`

  Пример использования:
  * `millidarating_top_day_4_votes` — количество голосов топ-4 за день *(максимум 10)*
  * `millidarating_top_week_5_votes` — количество голосов топ-5 за неделю *(максимум 10)*
  * `millidarating_top_month_6_votes` — количество голосов топ-6 за месяц *(максимум 10)*


# API

API уже есть, но пока никак его не подключить, кроме как через локальный мавен репозиторий. Чтобы это сделать,
клонируйте репозиторий и используйте команду `gradle :api:publishToMavenLocal`, после чего её можно будет импортировать.

## Импортирование
* Maven:
```xml
<dependencies>
  <dependency>
    <groupId>ru.leonidm.millida</groupId>
    <artifactId>millida-rating-api</artifactId>
    <version>1.0.1</version>
  </dependency>
</dependencies>
```

* Gradle:
```groovy
repositories {
  mavenLocal()
}

dependencies {
  implementation 'ru.leonidm.millida:millida-rating-api:1.0.1'
}
```

## Использование

Главной входной точкой в API является класс `MillidaRatingApi`, из которого можно получить экземпляр API
и уже оттуда достать все нужные сервисы.

Также есть Bukkit-события:
* `RatingVoteEvent` — вызывается, когда `RatingRequester` нашёл новый голос
* `OfflinePlayerAwardedEvent` — вызывается, когда игрок получил награду со свойством `online: false`
* `PlayerAwardedEvent` — вызывается, когда игрок получил награду со свойством `online: true`

**[!!!]** Если вы хотите получить информацию о голосах, используйте сервис `RatingRequester`, в котором
хранятся захэшированные значения, вместо `RatingRequestService`.
